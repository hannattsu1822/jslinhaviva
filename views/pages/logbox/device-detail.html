<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %></title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="stylesheet" href="/static/css/logbox/device-detail.css">
</head>
<body>
<div class="container is-fluid">
    <section class="section">

        <div class="level mb-5">
            <div class="level-left">
                <div class="level-item">
                    <div>
                        <p class="heading">
                            <span class="material-symbols-outlined" style="vertical-align: middle;">sensors</span>
                        </p>
                        <p class="title is-3"><%= device.local_tag %></p>
                    </div>
                </div>
            </div>

            <div class="level-right">
                <div class="level-item">
                    <a href="/gerenciar-dispositivos" class="button is-light">
                        <span class="icon">
                            <span class="material-symbols-outlined">arrow_back</span>
                        </span>
                        <span>Voltar</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="columns is-multiline mb-5">
            <div class="column is-3">
                <div class="box has-text-centered">
                    <span class="icon is-large has-text-link">
                        <span class="material-symbols-outlined" style="font-size: 48px;">device_thermostat</span>
                    </span>
                    <p class="heading mt-3">Temperatura Atual</p>
                    <p class="title is-4">
                        <span id="latest-temp">--</span>
                        <span class="is-size-5">°C</span>
                    </p>
                    <p class="help" id="latest-timestamp">Aguardando dados...</p>
                </div>
            </div>

            <div class="column is-3">
                <div class="box has-text-centered">
                    <span class="icon is-large has-text-success">
                        <span class="material-symbols-outlined" style="font-size: 48px;">signal_cellular_alt</span>
                    </span>
                    <p class="heading mt-3">Status da Conexão</p>
                    <p class="title is-4" id="connection-status-text">Verificando...</p>
                    <p class="help" id="diag-wifi-rssi">RSSI --</p>
                </div>
            </div>

            <div class="column is-3">
                <div class="box has-text-centered">
                    <span class="icon is-large has-text-warning">
                        <span class="material-symbols-outlined" style="font-size: 48px;">power</span>
                    </span>
                    <p class="heading mt-3">Fonte de Energia</p>
                    <p class="title is-5" id="diag-power-source">Verificando...</p>
                    <p class="help" id="diag-battery-voltage">Bateria --</p>
                </div>
            </div>

            <div class="column is-3">
                <div class="box has-text-centered">
                    <span class="icon is-large has-text-danger">
                        <span class="material-symbols-outlined" style="font-size: 48px;">warning</span>
                    </span>
                    <p class="heading mt-3">Alarmes Ativos</p>
                    <p class="title is-4" id="active-alarms-count">0</p>
                    <p class="help" id="alarm-subtitle">Nenhum alarme no momento</p>
                </div>
            </div>
        </div>

        <div class="columns is-multiline mb-5">
            <div class="column is-6">
                <div class="box">
                    <div class="level mb-4">
                        <div class="level-left">
                            <div class="level-item">
                                <span class="icon-text">
                                    <span class="icon">
                                        <span class="material-symbols-outlined">query_stats</span>
                                    </span>
                                    <span class="title is-5">Estatísticas (Hoje)</span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="content">
                        <div class="level is-mobile">
                            <div class="level-left">
                                <div class="level-item">
                                    <span>Mínima</span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <strong id="stat-today-min">-- °C</strong>
                                </div>
                            </div>
                        </div>

                        <div class="level is-mobile">
                            <div class="level-left">
                                <div class="level-item">
                                    <span>Média</span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <strong id="stat-today-avg">-- °C</strong>
                                </div>
                            </div>
                        </div>

                        <div class="level is-mobile">
                            <div class="level-left">
                                <div class="level-item">
                                    <span>Máxima</span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <strong id="stat-today-max">-- °C</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="column is-6">
                <div class="box">
                    <div class="level mb-4">
                        <div class="level-left">
                            <div class="level-item">
                                <span class="icon-text">
                                    <span class="icon">
                                        <span class="material-symbols-outlined">developer_board</span>
                                    </span>
                                    <span class="title is-5">Diagnóstico do Dispositivo</span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="content">
                        <div class="level is-mobile mb-3">
                            <div class="level-left">
                                <div class="level-item">
                                    <span class="icon-text">
                                        <span class="icon has-text-danger">
                                            <span class="material-symbols-outlined">device_thermostat</span>
                                        </span>
                                        <span>Temperatura Interna</span>
                                    </span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <span class="tag" id="diag-internal-temp">--</span>
                                </div>
                            </div>
                        </div>

                        <div class="level is-mobile mb-3">
                            <div class="level-left">
                                <div class="level-item">
                                    <span class="icon-text">
                                        <span class="icon has-text-link">
                                            <span class="material-symbols-outlined">public</span>
                                        </span>
                                        <span>Endereço IP</span>
                                    </span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <span class="tag" id="diag-ip-address">--</span>
                                </div>
                            </div>
                        </div>

                        <div class="level is-mobile mb-3">
                            <div class="level-left">
                                <div class="level-item">
                                    <span class="icon-text">
                                        <span class="icon">
                                            <span class="material-symbols-outlined">memory</span>
                                        </span>
                                        <span>Versão do Firmware</span>
                                    </span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">
                                    <span class="tag" id="diag-firmware-version">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="columns">
            <div class="column is-12">
                <div class="box">
                    <div class="level mb-4">
                        <div class="level-left">
                            <div class="level-item">
                                <span class="icon-text">
                                    <span class="icon">
                                        <span class="material-symbols-outlined">timeline</span>
                                    </span>
                                    <span class="title is-5">Histórico de Temperatura</span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container" style="position: relative; height: 400px; min-height: 400px;">
                        <div id="loader-historico" class="has-text-centered py-6" style="position: absolute; width: 100%; top: 40%;">
                            <button class="button is-loading is-ghost is-large"></button>
                            <p class="mt-3">Carregando histórico...</p>
                        </div>
                        <div id="graficoHistorico" style="width: 100%; height: 100%; min-height: 400px; display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script>
    const serialNumber = "<%= serialNumber %>";
</script>
<script src="/scripts/logbox/device-detail.js"></script>
</body>
</html>
