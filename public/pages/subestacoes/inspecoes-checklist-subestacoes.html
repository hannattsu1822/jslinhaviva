<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checklist de Inspeção de Subestação</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <link
      rel="stylesheet"
      href="/static/css/subestacoes/inspecoes-checklist-subestacoes.css"
    />
  </head>
  <body>
    <div class="container mt-4 mb-5">
      <header class="page-header mb-4 p-3 rounded">
        <h1 class="h3 mb-0 d-flex align-items-center">
          <span class="material-symbols-outlined fs-1 me-2">checklist_rtl</span>
          Checklist de Inspeção de Subestação
        </h1>
      </header>

      <main>
        <form id="formChecklistInspecao" enctype="multipart/form-data">
          <section id="cabecalhoInspecao" class="custom-card mb-4">
            <div class="custom-card-header">
              <h2 class="h5 mb-0 d-flex align-items-center">
                <span class="material-symbols-outlined me-2"
                  >assignment_ind</span
                >
                Dados da Inspeção
              </h2>
            </div>
            <div class="custom-card-body">
              <div class="row g-3">
                <div class="col-md-6 col-lg-4">
                  <label for="inspecaoSubestacao" class="form-label"
                    >Subestação:*</label
                  >
                  <select
                    id="inspecaoSubestacao"
                    name="subestacao_id"
                    class="form-select form-select-sm"
                    required
                  >
                    <option value="">Carregando...</option>
                  </select>
                </div>
                <div class="col-md-6 col-lg-4">
                  <label for="inspecaoResponsavel" class="form-label"
                    >Responsável:*</label
                  >
                  <select
                    id="inspecaoResponsavel"
                    name="responsavel_levantamento_id"
                    class="form-select form-select-sm"
                    required
                  >
                    <option value="">Carregando...</option>
                  </select>
                </div>
                <div class="col-md-6 col-lg-4">
                  <label for="inspecaoFormularioNumDisplay" class="form-label"
                    >Nº da Inspeção:</label
                  >
                  <input
                    type="text"
                    id="inspecaoFormularioNumDisplay"
                    name="formulario_inspecao_num_display"
                    class="form-control form-control-sm"
                    readonly
                    value="Será gerado ao salvar"
                  />
                </div>
                <div class="col-md-4">
                  <label for="inspecaoDataAvaliacao" class="form-label"
                    >Data Avaliação:*</label
                  >
                  <input
                    type="date"
                    id="inspecaoDataAvaliacao"
                    name="data_avaliacao"
                    class="form-control form-control-sm"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label for="inspecaoHoraInicial" class="form-label"
                    >Hora Inicial:*</label
                  >
                  <input
                    type="time"
                    id="inspecaoHoraInicial"
                    name="hora_inicial"
                    class="form-control form-control-sm"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label for="inspecaoHoraFinal" class="form-label"
                    >Hora Final (Opcional):</label
                  >
                  <input
                    type="time"
                    id="inspecaoHoraFinal"
                    name="hora_final"
                    class="form-control form-control-sm"
                  />
                </div>
              </div>
            </div>
          </section>

          <div id="checklistItensContainer" class="mb-4"></div>

          <section id="medicoesEquipamentosSection" class="custom-card mb-4">
            <div
              class="custom-card-header d-flex justify-content-between align-items-center"
            >
              <h2 class="h5 mb-0 d-flex align-items-center">
                <span class="material-symbols-outlined me-2">rule</span>
                Medições de Equipamentos
              </h2>
              <button
                type="button"
                id="btnAdicionarMedicao"
                class="btn btn-sm btn-primary"
              >
                Adicionar Medição
              </button>
            </div>
            <div class="custom-card-body">
              <div id="containerMedicoesDinamicas">
                <p id="nenhumaMedicaoAdicionada" class="text-muted text-center">
                  Nenhuma medição adicionada ainda.
                </p>
              </div>
            </div>
          </section>

          <section id="anexosInspecaoSection" class="custom-card mb-4">
            <div class="custom-card-header">
              <h2 class="h5 mb-0 d-flex align-items-center">
                <span class="material-symbols-outlined me-2">attachment</span>
                Anexos Gerais da Inspeção
              </h2>
            </div>
            <div class="custom-card-body">
              <fieldset class="anexos-fieldset border p-3 rounded">
                <legend class="legend-sm float-none w-auto px-2">
                  <span class="material-symbols-outlined">file_upload</span>
                  Adicionar Anexos Gerais
                </legend>
                <div class="mb-3">
                  <label
                    for="inspecaoAnexosInput"
                    class="form-label visually-hidden"
                    >Selecionar arquivos (Opcional, máx. 10):</label
                  >
                  <div class="file-input-modern-wrapper">
                    <input
                      type="file"
                      id="inspecaoAnexosInput"
                      name="anexosInspecao"
                      multiple
                      accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx,.txt,.heic,.heif"
                      class="file-input-modern-hidden"
                    />
                    <label
                      for="inspecaoAnexosInput"
                      class="file-input-modern-trigger p-4"
                    >
                      <span
                        class="material-symbols-outlined file-input-icon fs-2 mb-2"
                        >cloud_upload</span
                      >
                      <span class="file-input-text">
                        Arraste arquivos aqui ou
                        <strong>clique para selecionar</strong>.
                        <br />
                        <small class="text-muted d-block mt-1"
                          >(Opcional, máx. 10 arquivos)</small
                        >
                      </span>
                    </label>
                  </div>
                  <ul
                    id="listaNomesAnexosInspecao"
                    class="list-group list-group-flush anexos-list mt-2"
                  ></ul>
                  <small class="form-text text-muted d-block text-center mt-2"
                    >Tipos: PDF, Imagens, Documentos, Planilhas, TXT.</small
                  >
                </div>
              </fieldset>
            </div>
          </section>

          <section id="observacoesGeraisSection" class="custom-card mb-4">
            <div class="custom-card-header">
              <h2 class="h5 mb-0 d-flex align-items-center">
                <span class="material-symbols-outlined me-2"
                  >speaker_notes</span
                >
                Observações Gerais
              </h2>
            </div>
            <div class="custom-card-body">
              <div class="mb-2">
                <textarea
                  id="inspecaoObservacoesGerais"
                  name="observacoes_gerais"
                  rows="4"
                  class="form-control form-control-sm"
                  placeholder="Observações gerais sobre a inspeção..."
                ></textarea>
              </div>
              <p class="legenda-obs alert alert-secondary p-2" role="alert">
                <strong>OBS.:</strong> Toda atividade em subestações exige o uso
                de EPIs.
              </p>
            </div>
          </section>

          <div
            class="d-flex justify-content-end gap-2 p-3 border-top mt-4 bg-light rounded-bottom page-form-actions"
          >
            <button
              type="button"
              id="btnCancelarChecklist"
              class="btn btn-app-clear btn-sm"
            >
              Cancelar
            </button>
            <button
              type="submit"
              id="btnSalvarInspecao"
              class="btn btn-success btn-sm"
            >
              <span class="material-symbols-outlined">save</span> Salvar
              Inspeção
            </button>
          </div>
        </form>
      </main>
    </div>

    <div
      class="modal fade"
      id="modalJustificativaAnormalidade"
      tabindex="-1"
      aria-labelledby="modalJustificativaLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content custom-modal-content">
          <div class="modal-header custom-modal-header">
            <h5
              class="modal-title d-flex align-items-center"
              id="modalJustificativaLabel"
            >
              <span class="material-symbols-outlined me-2 text-warning"
                >report_problem</span
              >
              Justificar Anormalidade
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Fechar"
            ></button>
          </div>
          <div class="modal-body">
            <div
              id="itemAnormalDescricao"
              class="alert alert-warning p-2 small"
              role="alert"
            ></div>
            <div class="mb-3">
              <label for="justificativaAnormalidadeTextarea" class="form-label"
                >Justificativa da Anormalidade:*</label
              >
              <textarea
                id="justificativaAnormalidadeTextarea"
                class="form-control form-control-sm"
                rows="3"
                required
                placeholder="Descreva o motivo da anormalidade..."
              ></textarea>
            </div>
            <div class="mb-3">
              <label
                for="fotoAnormalidadeInput"
                class="form-label visually-hidden"
                >Foto de Evidência (Obrigatória):*</label
              >
              <div class="file-input-modern-wrapper modal-file-input">
                <input
                  type="file"
                  id="fotoAnormalidadeInput"
                  name="fotoAnormalidade"
                  accept="image/*"
                  required
                  class="file-input-modern-hidden"
                />
                <label
                  for="fotoAnormalidadeInput"
                  class="file-input-modern-trigger p-3"
                >
                  <span
                    class="material-symbols-outlined file-input-icon fs-3 mb-1"
                    >add_a_photo</span
                  >
                  <span class="file-input-text small">
                    Arraste a foto ou <strong>clique para selecionar</strong>.
                    <small class="text-muted d-block mt-1">(Obrigatória)</small>
                  </span>
                </label>
              </div>
              <div
                id="fotoAnormalidadePreviewContainer"
                class="modal-file-preview-container mt-2"
                style="display: none"
              >
                <img
                  id="fotoAnormalidadePreview"
                  class="img-thumbnail"
                  src="#"
                  alt="Pré-visualização"
                  style="max-width: 150px; max-height: 150px; display: none"
                />
                <button
                  type="button"
                  id="btnDeleteFotoAnormalidade"
                  class="btn btn-icon text-danger btn-sm ms-2"
                  style="display: none"
                  title="Remover foto"
                >
                  <span class="material-symbols-outlined">delete</span>
                </button>
              </div>
              <small
                id="fotoAnormalidadeNome"
                class="form-text text-muted d-block text-center mt-1"
                >Nenhuma foto selecionada.</small
              >
            </div>
          </div>
          <div class="modal-footer custom-modal-footer">
            <button
              type="button"
              class="btn btn-app-clear btn-sm"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              id="btnSalvarJustificativa"
              class="btn btn-primary btn-sm"
            >
              <span class="material-symbols-outlined">check_circle</span>
              Confirmar Justificativa e Foto
            </button>
          </div>
        </div>
      </div>
    </div>

    <template id="templateLinhaMedicao">
      <div class="medicao-dinamica-item row g-3 mb-3 p-3 border rounded">
        <div class="col-md-3">
          <label class="form-label form-label-sm">Tipo de Medição:*</label>
          <select
            name="tipo_medicao[]"
            class="form-select form-select-sm tipo-medicao"
            required
          >
            <option value="">Selecione...</option>
            <option value="TEMPERATURA_TRAFO">Temperatura Trafo (°C)</option>
            <option value="CONTADOR_RELIGADOR">Contador Religador (qnt)</option>
            <option value="BATERIA_MONITOR">Bateria Monitor (%)</option>
            <option value="OUTRO">Outro</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label form-label-sm">TAG Equipamento:</label>
          <input
            type="text"
            name="tag_equipamento_medicao[]"
            class="form-control form-control-sm tag-equipamento-medicao"
            placeholder="Ex: F041"
          />
        </div>
        <div class="col-md-3">
          <label class="form-label form-label-sm">Valor Lido:*</label>
          <input
            type="text"
            name="valor_medido[]"
            class="form-control form-control-sm valor-medido"
            required
            placeholder="Ex: 65.5 ou 120"
          />
        </div>
        <div class="col-md-2">
          <label class="form-label form-label-sm">Unidade:</label>
          <input
            type="text"
            name="unidade_medida[]"
            class="form-control form-control-sm unidade-medida"
            placeholder="°C, qnt, %"
          />
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button
            type="button"
            class="btn btn-danger btn-sm btn-remover-medicao"
            title="Remover Medição"
          >
            <span class="material-symbols-outlined">delete</span>
          </button>
        </div>
        <div class="col-12">
          <label class="form-label form-label-sm">Observação (Opcional):</label>
          <input
            type="text"
            name="obs_medicao[]"
            class="form-control form-control-sm obs-medicao"
            placeholder="Detalhes adicionais..."
          />
        </div>
      </div>
    </template>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="/scripts/subestacoes/inspecoes-checklist-subestacoes.js"></script>
  </body>
</html>
