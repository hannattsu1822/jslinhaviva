<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Relatório de Serviço - <%= data.id %></title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        margin: 20px;
        font-size: 10pt;
        color: #333;
      }
      .header {
        text-align: center;
        border-bottom: 2px solid #004a99;
        padding-bottom: 10px;
        margin-bottom: 20px;
      }
      .header h1 {
        margin: 0;
        color: #004a99;
        font-size: 18pt;
      }
      .header p {
        margin: 5px 0 0;
        font-size: 10pt;
        color: #555;
      }
      .section {
        margin-bottom: 20px;
        page-break-inside: avoid;
      }
      .section-title {
        font-size: 12pt;
        font-weight: bold;
        color: #004a99;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
        margin-bottom: 10px;
      }
      .grid-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px 20px;
      }
      .grid-item {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        padding: 8px;
        border-radius: 4px;
        overflow-wrap: break-word;
      }
      .grid-item strong {
        display: block;
        color: #495057;
        margin-bottom: 4px;
        font-size: 8pt;
        text-transform: uppercase;
      }
      .full-width {
        grid-column: 1 / -1;
      }
      .description {
        white-space: pre-wrap;
        font-size: 10pt;
      }
      .item-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      .item-table th,
      .item-table td {
        border: 1px solid #dee2e6;
        padding: 6px;
        text-align: left;
        font-size: 9pt;
      }
      .item-table th {
        background-color: #e9ecef;
        font-weight: bold;
      }
      .status-concluido {
        color: #155724;
      }
      .status-nao-concluido {
        color: #721c24;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Relatório Consolidado de Serviço</h1>
      <p>Documento gerado em: <%= new Date().toLocaleString('pt-BR') %></p>
    </div>

    <div class="section">
      <h2 class="section-title">Informações Gerais do Serviço</h2>
      <div class="grid-container">
        <div class="grid-item">
          <strong>ID do Serviço:</strong> <%= data.id %>
        </div>
        <div class="grid-item">
          <strong>Processo:</strong> <%= data.processo || 'N/A' %>
        </div>
        <div class="grid-item">
          <strong>Status:</strong> <%= data.status.replace('_', '
          ').toUpperCase() %>
        </div>
        <div class="grid-item">
          <strong>Data Prevista:</strong> <%= data.data_prevista_execucao %>
        </div>
        <div class="grid-item">
          <strong>Subestação:</strong> <%= data.subestacao %>
        </div>
        <div class="grid-item">
          <strong>Alimentador:</strong> <%= data.alimentador || 'N/A' %>
        </div>
        <div class="grid-item">
          <strong>Encarregado(s):</strong> <%= data.responsavel_nome ||
          data.responsavel_matricula || 'N/A' %>
        </div>
        <div class="grid-item">
          <strong>Desligamento:</strong> <%= data.desligamento %>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Descrição do Registro</h2>
      <div class="grid-container">
        <div class="grid-item full-width description">
          <strong>Descrição / Motivo do Serviço:</strong>
          <p>
            <%= data.descricao_servico || data.descricao_geral || 'Nenhuma
            descrição fornecida.' %>
          </p>
        </div>
        <div class="grid-item full-width description">
          <strong>Observações do Registro:</strong>
          <p>
            <%= data.observacoes || data.observacoes_gerais || 'Nenhuma
            observação fornecida.' %>
          </p>
        </div>
      </div>
    </div>

    <% if (data.itens && data.itens.length > 0) { %>
    <div class="section">
      <h2 class="section-title">Itens da Ordem de Serviço (Tarefas)</h2>
      <table class="item-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Descrição da Tarefa</th>
            <th>Status Final</th>
            <th>Observações da Finalização</th>
          </tr>
        </thead>
        <tbody>
          <% data.itens.forEach(item => { %>
          <tr>
            <td><%= item.codigo %></td>
            <td><%= item.descricao %></td>
            <td
              class="<%= item.status === 'concluido' ? 'status-concluido' : 'status-nao-concluido' %>"
            >
              <%= item.status.replace('_', ' ').toUpperCase() %>
            </td>
            <td><%= item.observacoes || 'Nenhuma' %></td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <% } %> <% if (data.status === 'concluido' || data.status ===
    'nao_concluido') { %>
    <div class="section">
      <h2 class="section-title">Dados de Finalização</h2>
      <div class="grid-container">
        <div class="grid-item">
          <strong>Data de Finalização:</strong> <%= data.data_conclusao || 'N/A'
          %>
        </div>
        <div class="grid-item">
          <strong>Status Final:</strong> <%= data.status.replace('_', '
          ').toUpperCase() %>
        </div>
        <div class="grid-item full-width description">
          <strong>Observações Gerais da Finalização:</strong>
          <% if (data.sistema_versao === 'legado') { %>
          <p><%= data.motivo || 'Nenhuma observação registrada.' %></p>
          <% } else { %>
          <p>
            <%= data.observacoes_conclusao || 'Nenhuma observação geral
            registrada.' %>
          </p>
          <% } %>
        </div>
      </div>
    </div>
    <% } %>
  </body>
</html>
